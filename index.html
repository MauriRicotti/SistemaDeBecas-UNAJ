<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sistema de Gestión de Becas - Fotocopiado</title>
        <script>
            // Aplicar tema guardado lo antes posible para evitar parpadeo (FOUC)
            try {
                const t = localStorage.getItem('theme') || 'dark'
                if (t === 'light') document.documentElement.setAttribute('data-theme', 'light')
                else document.documentElement.setAttribute('data-theme', 'dark')
                if ('scrollRestoration' in history) history.scrollRestoration = 'manual'
            } catch (e) { /* ignore */ }
        </script>
        <link rel="stylesheet" href="Style.css">
    </head>
    <body>
                <!-- Barra de búsqueda flotante que aparece al hacer scroll -->
                <div id="floatingSearch" class="floating-search" aria-hidden="true">
                    <div class="floating-search-inner">
                        <svg class="svg-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        <input id="floatingSearchInput" class="search-input" type="text" placeholder="Buscar cliente...">
                    </div>
                </div>
        <header class="header">
            <div class="container header-grid">
                <div class="header-left">
                    <h1><B>SISTEMA DE BECAS</B></h1>
                    <div class="header-subtitle">Gestión de becas para estudiantes de la UNAJ</div>
                </div>
                <div class="header-right">
                    <div class="turno-selector header-control">
                        <label>Turno:</label>
                        <select id="turnoSelect">
                            <option value="Mañana">Mañana</option>
                            <option value="Tarde">Tarde</option>
                            <option value="Unico">Único</option>
                        </select>
                    </div>
                    <div id="digitalClock" class="digital-clock header-control" aria-live="polite">--:--:--</div>
                    <!-- Elemento accesible que describe la advertencia de turno -->
                    <div id="turno-warning" style="display:none;">Atención: el turno seleccionado parece no corresponder al horario actual. Verificar selección.</div>
                    <!-- Se removió el badge de sincronización solicitada -->
                    <div class="header-actions">
                        <button id="btnRefresh" class="icon-btn" title="Actualizar" aria-label="Actualizar">
                            <!-- SVG icon: refresh (mejorado) -->
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12a9 9 0 1 0-3.53 6.93"/><polyline points="21 12 21 7 16 7"/></svg>
                        </button>
                        <button id="btnDownload" class="icon-btn" title="Descargar" aria-label="Descargar">
                            <!-- SVG icon: download -->
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </button>
                        <button id="btnStats" class="icon-btn" title="Estadísticas" aria-label="Estadísticas">
                            <!-- SVG icon: stats -->
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="8" y1="14" x2="8" y2="11"/><line x1="12" y1="17" x2="12" y2="11"/><line x1="16" y1="10" x2="16" y2="11"/></svg>
                        </button>
                        <button id="btnThemeToggle" class="icon-btn" title="Alternar tema" aria-label="Alternar tema" aria-pressed="false">
                            <!-- Icono luna -->
                            <svg class="icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                            <!-- Icono sol -->
                            <svg class="icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
                        </button>
                        <button id="btnOpenGenerateModal" class="icon-btn" title="Generar Libro PDF" aria-label="Generar Libro" onclick="openModal('generateBookModal')">
                            <!-- SVG icon: simple book/form -->
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 19.5A2.5 2.5 0 0 0 6.5 17H20V5H6.5A2.5 2.5 0 0 0 4 7.5z"/><line x1="8" y1="8" x2="16" y2="8"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="container">
            <section class="card search-card">
                <div class="search-card-header">
                    <div>
                        <div class="search-title">Buscar Cliente</div>
                        <div class="search-subtitle">Busca por nombre, apellido o DNI</div>
                    </div>
                </div>
                <div class="search-body search-row">
                    <div class="search-input-wrapper" style="flex:1; height:45px;">
                        <input id="searchInput" class="search-input" type="text" placeholder="Buscar cliente..." style="height:35px;">
                    </div>
                    <div class="search-add-btn-wrapper"><button class="btn btn-primary" onclick="openAddClientModal()">Agregar Cliente</button></div>
                </div>
            </section>

            <section class="card clients-card">
                <div class="card-header clients-header">
                    <div>
                            <h2>Clientes Registrados</h2>
                        </div>
                        <div class="clients-header-actions">
                            <button id="btnFilters" class="btn btn-secondary" onclick="openFiltersModal()" aria-label="Abrir filtros" title="Filtros">
                                <!-- icono pequeño de embudo opcional -->
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M22 3H2l7 8v6l6 4v-10l7-8z"/></svg>
                                <span style="margin-left:0.4rem;">Filtros</span>
                            </button>
                                <!-- Selector de cantidad por página (6,9,12,15,18) -->
                                <label id="pageSizeLabel" style="display:flex; align-items:center; gap:0.4rem; font-size:0.95rem;">
                                    Mostrar
                                    <select id="pageSizeSelect" style="margin:0 0.35rem;">
                                        <option value="6">6</option>
                                        <option value="9">9</option>
                                        <option value="12">12</option>
                                        <option value="15">15</option>
                                        <option value="18">18</option>
                                    </select>
                                </label>
                                <!-- Contenedor breve para mostrar cantidad total -->
                                <div id="clientCount" style="font-size:0.95rem; color:var(--text-muted);">0 clientes</div>
                        </div>
                </div>
                <div id="clientsList" class="clients-list"></div>
                    <!-- Controles de paginación: Primero / Anterior / números / Siguiente / Último -->
                    <div id="paginationContainer" style="display:flex; justify-content:center; margin:18px 0; flex-direction:column; align-items:center;">
                        <div id="pagination" aria-label="Paginación"></div>
                        <div id="paginationHint" style="margin-top:8px; font-size:0.82rem; color:var(--text-muted);">Atajo: Ctrl ← / Ctrl → para navegar páginas</div>
                    </div>
            </section>
        </main>

    <!-- Botón volver arriba -->
    <button id="backToTop" class="back-to-top" aria-label="Volver arriba" title="Volver arriba">
        <!-- Flecha hacia arriba con caja redondeada -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="1" y="1" width="22" height="22" rx="4" opacity="0.04"/>
            <path d="M12 16 V8" />
            <path d="M8 12 L12 8 L16 12" />
        </svg>
    </button>

        <!-- Modales y elementos que usa Main.js (IDs requeridos) -->
        <div id="addClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h3>Agregar Nuevo Cliente</h3><button class="close-btn" onclick="closeModal('addClientModal')">&times;</button></div>
                <form id="addClientForm" onsubmit="handleAddClient(event)">
                    <div class="form-group"><label for="nombreApellido">Nombre y Apellido</label><input id="nombreApellido" name="nombreApellido" type="text" required placeholder="Nombre y Apellido"></div>
                    <div class="form-group"><label for="dni">DNI</label><input id="dni" name="dni" type="text" required placeholder="DNI"></div>
                    <div class="form-group"><label for="carrera">Carrera</label><input id="carrera" name="carrera" type="text" required placeholder="Carrera"></div>
                    <div class="form-row">
                        <div class="form-group" style="flex:1"><label for="instituto">Instituto</label><select id="instituto" name="instituto" required><option value="">Seleccionar...</option><option value="Salud">Salud</option><option value="Sociales">Sociales</option><option value="Ingeniería">Ingeniería</option></select></div>
                        <div class="form-group" style="width:120px; margin-left:0.5rem"><label for="tipoBeca">Tipo de Beca</label><select id="tipoBeca" name="tipoBeca" required><option value="">Seleccionar...</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select></div>
                    </div>
                    <div class="form-group"><label for="numeroOrden">Número de Orden</label><input id="numeroOrden" name="numeroOrden" type="number" min="1" required placeholder="Número de Orden"></div>
                    <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('addClientModal')">Cancelar</button><button type="submit" class="btn btn-primary">Agregar Cliente</button></div>
                </form>
            </div>
        </div>

        <!-- Modal para generar libro PDF -->
        <div id="generateBookModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header"><h3>Generar Libro PDF</h3><button class="close-btn" onclick="closeModal('generateBookModal')">&times;</button></div>
                <div style="padding:1rem;">
                    <p style="color:var(--text-muted); font-size:0.95rem;">Genera un PDF por libro. Elige un Instituto y/o Tipo de Beca para filtrar. Si no eliges nada se generará un PDF con todos los clientes. También puedes generar los 9 libros y descargarlos en un ZIP.</p>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.75rem; align-items:center; margin-top:0.75rem;">
                        <div>
                            <div>
                                <label for="generateInstituto" style="display:block; font-size:0.85rem; color:var(--text-secondary);">Instituto</label>
                                <select id="generateInstituto" style="padding:0.5rem; border-radius:0.35rem; background:var(--bg-card); color:var(--text-primary); border:1px solid var(--border-color);">
                                    <option value="">Todos</option>
                                    <option value="Salud">Salud</option>
                                    <option value="Sociales">Sociales</option>
                                    <option value="Ingeniería">Ingeniería</option>
                                </select>
                            </div>
                            <div>
                                <label for="generateTipoBeca" style="display:block; font-size:0.85rem; color:var(--text-secondary);">Tipo</label>
                                <select id="generateTipoBeca" style="padding:0.5rem; border-radius:0.35rem; background:var(--bg-card); color:var(--text-primary); border:1px solid var(--border-color);">
                                    <option value="">Todos</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:0.75rem; display:flex; gap:0.75rem; align-items:center;">
                        <label style="display:flex; align-items:center; gap:0.5rem;"><input type="checkbox" id="generateAllBooks" /> Generar y descargar los 9 libros por separado (ZIP)</label>
                    </div>

                    <div style="display:flex; justify-content:flex-end; gap:0.5rem; margin-top:1rem;">
                        <button class="btn btn-secondary" onclick="closeModal('generateBookModal')">Cancelar</button>
                        <button class="btn btn-primary" id="btnGenerateBook">Generar PDF</button>
                    </div>
                    <div id="generateReport" style="margin-top:0.75rem; color:var(--text-secondary); font-size:0.9rem;"></div>
                </div>
            </div>
        </div>

        <div id="editClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h3>Editar Cliente</h3><button class="close-btn" onclick="closeModal('editClientModal')">&times;</button></div>
                <form id="editClientForm" onsubmit="handleEditClient(event)">
                    <input id="editClientId" type="hidden">
                    <div class="form-group"><label for="editNombreApellido">Nombre y Apellido</label><input id="editNombreApellido" name="editNombreApellido" type="text" required placeholder="Nombre y Apellido"></div>
                    <div class="form-group"><label for="editDni">DNI</label><input id="editDni" name="editDni" type="text" required placeholder="DNI"></div>
                    <div class="form-group"><label for="editCarrera">Carrera</label><input id="editCarrera" name="editCarrera" type="text" required placeholder="Carrera"></div>
                    <div class="form-row">
                        <div class="form-group" style="flex:1"><label for="editInstituto">Instituto</label>
                            <select id="editInstituto" name="editInstituto" required>
                                <option value="Salud">Salud</option>
                                <option value="Sociales">Sociales</option>
                                <option value="Ingeniería">Ingeniería</option>
                            </select>
                        </div>
                        <div class="form-group" style="width:120px; margin-left:0.5rem"><label for="editTipoBeca">Tipo de Beca</label>
                            <select id="editTipoBeca" name="editTipoBeca" required>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label for="editNumeroOrden">Número de Orden</label><input id="editNumeroOrden" name="editNumeroOrden" type="number" min="1" required placeholder="Número de Orden"></div>
                    <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('editClientModal')">Cancelar</button><button type="submit" class="btn btn-primary">Guardar Cambios</button></div>
                </form>
            </div>
        </div>

        <div id="addImpresionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h3>Agregar Impresión</h3><button class="close-btn" onclick="closeModal('addImpresionModal')">&times;</button></div>
                <div class="impresion-info">
                    <div><span>Cliente:</span> <span id="impresionClientName"></span></div>
                    <div><span>Tipo de Beca:</span> <span id="impresionBecaType"></span></div>
                    <div><span>Límite Mensual:</span> <span id="impresionLimit"></span></div>
                    <div><span>Carillas Restantes:</span> <span id="impresionRemaining"></span></div>
                </div>
                <form id="addImpresionForm" onsubmit="handleAddImpresion(event)">
                    <input id="impresionClientId" type="hidden">
                    <div class="form-group">
                        <label for="cantidadCarillas">Cantidad de carillas</label>
                        <input id="cantidadCarillas" name="cantidadCarillas" type="number" min="1" required placeholder="Cantidad">
                    </div>
                    <div id="warningMessage" class="warning-message" style="display:none;">Esta cantidad excede el límite mensual del cliente</div>
                    <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('addImpresionModal')">Cancelar</button><button type="submit" class="btn btn-primary">Registrar Impresión</button></div>
                </form>
            </div>
        </div>

        <div id="historialModal" class="modal"><div class="modal-content modal-large"><div class="modal-header"><h3>Historial de Impresiones</h3><button class="close-btn" onclick="closeModal('historialModal')">&times;</button></div><div id="historialContent" class="historial-content"></div></div></div>

        <div id="statsModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Estadísticas del Mes</h3><button class="close-btn" onclick="closeModal('statsModal')">&times;</button></div><div id="statsContent" class="stats-content"></div></div></div>

                <div id="filtersModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header"><h3>Filtros Avanzados</h3><button class="close-btn" onclick="closeModal('filtersModal')">&times;</button></div>
                        <form id="filtersForm">
                            <div class="form-row">
                                <div class="form-group"><label for="filterMes">Mes</label><select id="filterMes" name="filterMes"><option value="">Todos</option></select></div>
                                <div class="form-group"><label for="filterAno">Año</label><select id="filterAno" name="filterAno"><option value="">Todos</option></select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="filterTurno">Turno</label><select id="filterTurno" name="filterTurno"><option value="">Todos</option><option value="Mañana">Mañana</option><option value="Tarde">Tarde</option><option value="Noche">Noche</option></select></div>
                                <div class="form-group"><label for="filterTipoBeca">Tipo de Beca</label><select id="filterTipoBeca" name="filterTipoBeca"><option value="">Todos</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select></div>
                            </div>
                            <div class="form-group"><label for="filterInstituto">Instituto</label><select id="filterInstituto" name="filterInstituto"><option value="">Todos</option><option value="Salud">Salud</option><option value="Sociales">Sociales</option><option value="Ingeniería">Ingeniería</option></select></div>
                            <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="clearFilters()">Limpiar Filtros</button><button type="button" class="btn btn-primary" onclick="applyFilters()">Aplicar Filtros</button></div>
                        </form>
                    </div>
                </div>

        <div id="deleteClientModal" class="modal"><div class="modal-content modal-small"><div class="modal-header"><h3>Eliminar Cliente</h3><button class="close-btn" onclick="closeModal('deleteClientModal')">&times;</button></div><div class="delete-warning"><p>¿Estás seguro de que deseas eliminar este cliente?</p><p id="deleteClientName" class="client-name"></p></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('deleteClientModal')">Cancelar</button><button type="button" class="btn btn-danger" onclick="confirmDeleteClient()">Eliminar</button></div></div></div>

        <div id="resetMonthModal" class="modal"><div class="modal-content modal-small"><div class="modal-header"><h3>Reiniciar Mes</h3><button class="close-btn" onclick="closeModal('resetMonthModal')">&times;</button></div><div class="delete-warning"><p>¿Estás seguro?</p></div><div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('resetMonthModal')">Cancelar</button><button type="button" class="btn btn-primary" onclick="confirmResetMonth()">Reiniciar Mes</button></div></div></div>

                <div id="downloadModal" class="modal">
                    <div class="modal-content modal-large">
                        <div class="modal-header"><h3>Descargar Base de Clientes (PDF)</h3><button class="close-btn" onclick="closeModal('downloadModal')">&times;</button></div>
                        <div style="padding:1.25rem;">
                            <p style="color:var(--text-muted); font-size:0.95rem;">Selecciona opcionalmente un Instituto y/o Tipo de Beca. Si dejas ambos en "Todos" se descargará la base completa de clientes (tabla con nombre, DNI, carrera, número de orden, instituto y tipo de beca).</p>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.75rem; align-items:center; margin-top:0.75rem;">
                                <div>
                                    <label for="downloadInstituto" style="display:block; font-size:0.85rem; color:var(--text-secondary);">Instituto</label>
                                    <select id="downloadInstituto" style="padding:0.5rem; border-radius:0.35rem; background:var(--bg-card); color:var(--text-primary); border:1px solid var(--border-color);">
                                        <option value="">Todos</option>
                                        <option value="Salud">Salud</option>
                                        <option value="Sociales">Sociales</option>
                                        <option value="Ingeniería">Ingeniería</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="downloadTipoBeca" style="display:block; font-size:0.85rem; color:var(--text-secondary);">Tipo de Beca</label>
                                    <select id="downloadTipoBeca" style="padding:0.5rem; border-radius:0.35rem; background:var(--bg-card); color:var(--text-primary); border:1px solid var(--border-color);">
                                        <option value="">Todos</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                            </div>

                            <div style="display:flex; justify-content:flex-end; gap:0.5rem; margin-top:1rem;">
                                <button class="btn btn-secondary" onclick="closeModal('downloadModal')">Cancelar</button>
                                <button class="btn btn-primary" id="btnDownloadClients">Generar PDF</button>
                            </div>
                            <div id="downloadReport" style="margin-top:0.75rem; color:var(--text-secondary); font-size:0.9rem;"></div>
                        </div>
                    </div>
                </div>

    <div id="toast" class="toast"></div>

        <script type="module" src="Main.js"></script>
    </body>
</html>
